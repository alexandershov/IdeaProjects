## Bazel
Bazel is a language-agnostic build system. 

You write build rules in Starlark.

Starlark is basically a heavily restricted subset of Python.

Bazel allows you to describe dependencies and run rules only when rule inputs change.

Bazel uses cache to speed up build process. It caches downloaded files, rule ouputs etc.
Cache is implemented as Content Addressable Storage similar to git.

Install:
```shell
brew install bazelisk
```

Bazelisk is a wrapper around bazel, that can download the required version
of bazel and run it.

Run target:
```shell
bazel run :print_leetcode_problem
```

See .bzl and .bazel files for how `:print_leetcode_problem` target is defined.

## Query

Executable path in bazel-out, can be joined with workspace_root to get the absolute path
```shell
bazel cquery --output=starlark --starlark:expr='target.files_to_run.executable.path' //:check_runfiles
```

Executable path in runfiles
```shell
bazel cquery --output=starlark --starlark:expr='target.files_to_run.executable.short_path' //:check_runfiles
```

Find all dependencies of a target:
```shell
bazel query --notool_deps 'deps(:check_runfiles)'
```

Find some dependency path between two targets
```shell
bazel query --notool_deps 'somepath(:check_runfiles, @bazel_tools//src/main/cpp/util:logging.cc)'
```

Find who depends on a target (aka "reversed dependencies")
```shell
bazel query --notool_deps 'rdeps(//..., check_runfiles.py)'
```

Find packages
```shell
bazel query '//...' --output=package
```

Find rules
```shell
bazel query 'kind("rule", //...)'
```

Find targets generated by a macro `py_test`
```shell
bazel query 'attr(generator_function, py_test, //...)'
```

Find files generated by rules
```shell
bazel query 'kind("generated file", //...)'
```

Find medium tests
```shell
bazel query 'attr(size, "medium", tests(//...))'
```

Find all tests
```shell
bazel query 'tests(//...)'
```

Find all source files (for some reason it doesn't work)
```shell
bazel query 'kind("source file", //...)'
```

Find differences between dependencies
```shell
bazel query --notool_deps 'deps(//...) except deps(//subpackage/...)'
```

Find common things between dependencies (`//:*` are all targets in root package)
```shell
bazel query --notool_deps 'deps(//:*) intersect deps(//subpackage/...)'
```